<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Anthem Market Place</title>
	<meta name="author" content="Feng X.">
	<link rel="stylesheet" type="text/css" href="/static/css/reset-min.css">

	<!-- Channel API, must be the first one! -->
	<script type="text/javascript" src="/_ah/channel/jsapi"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
	<!--LINK REL=StyleSheet HREF="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/dot-luv/jquery-ui.min.css" TYPE="text/css" MEDIA=screen-->
	<LINK REL=StyleSheet HREF="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/smoothness/jquery-ui.min.css" TYPE="text/css" MEDIA=screen>
	<script src="https://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>

	<!-- JS to turn a form into AJAX call -->
	<script src="/static/formjs/jquery.form.js"></script> 

	<!-- toast -->
	<script src="/static/toast/jquery.toastmessage.js" type="text/javascript"></script> 
	<LINK REL=StyleSheet HREF="/static/toast/css/jquery.toastmessage.css" TYPE="text/css" MEDIA=screen>
	
	<!-- jQuery dataTable -->
	<script type="text/javascript" src="/static/DataTables-1.9.4/media/js/jquery.dataTables.min.js"></script>
	<LINK REL=StyleSheet HREF="/static/DataTables-1.9.4/media/css/jquery.dataTables.css" TYPE="text/css" MEDIA=screen>
	<link rel="stylesheet" type="text/css" href="/static/beautiful_tables/cell_styles.css">
		
	<!-- carousel -->
	<script type="text/javascript" src="/static/carouFredSel-6.2.0/jquery.carouFredSel-6.2.0.js"></script>

	<!-- easing -->
	<!-- http://gsgd.co.uk/sandbox/jquery/easing/ -->
	<script type="text/javascript" src="/static/easing/jquery.easing.min.js"></script>

	<!-- tinyMCE -->
	<script type="text/javascript" src="/static/tinymce/js/tinymce/jquery.tinymce.min.js"></script>	
	<script type="text/javascript" src="/static/tinymce/js/tinymce/tinymce.min.js"></script>	
		
	<!-- highcharts -->
	<script src="http://code.highcharts.com/highcharts.js"></script>
	
	<LINK REL=StyleShyeet HREF="/static/css/navigation.css" TYPE="text/css" MEDIA=screen>
	<LINK REL=StyleSheet HREF="/static/css/screen.css" TYPE="text/css" MEDIA=screen>
		
	<script type="text/javascript">
	// some global initialization
	var j$=jQuery.noConflict();
 
 	function formatChannelMessage(sender_name,message){
   		var html='';
    	html+='<div class="channel-message">';
    	html+='<span class="channel-sender">';
    	html+=sender_name+'</span>';
    	html+='<br />';
    	html+='<div class="channel-message-content">';
    	html+=message;
    	html+='</div>';
    	html+='</div>';
  		return html;
 	}
 	function refreshChannelMessage(html){
 		// as a circular buffer, showing 10
 		// so the oldest gets bumped off the list
 		var existing=j$('#channel-message').find('div.channel-message');
 		
 		if (existing.length>=10){
 			for (var i=0; i<(existing.length-10);i++){
 				j$(existing[i]).fadeOut(500,function(){
 					j$(this).remove();
 				});
 			}
 		}
 		j$('#channel-message').append(html);
 	}
 	
	j$(document).ready(function(){
		j$('input[type="date"]').datepicker();

		j$('input[name="channel-message"]').keypress(function(event) {
    		var keycode = (event.keyCode ? event.keyCode : event.which);
        	if(keycode == '13') {
				var receiver_name=j$('input[name="receiver-name"]').val();
				var message=j$('input[name="channel-message"]').val();
				var data={'sender':'{{me.key.id()}}',
					'receiver':receiver_name,
					'message':message
					}
				j$.post(
					'/channel/route',
					data,
					function(result){
						//j$().toastmessage('showNoticeToast','Sent');
						var html=formatChannelMessage('me',message);
    					refreshChannelMessage(html);
    					
    					// clear input box
    					j$('input[name="channel-message"]').val('');
					}
				);
            }
        });
                    		
		j$('#send-channel-message').click(function(){
		});
	});
	</script>	
	
	{% block customJS %}{% endblock %}
</head>

{% autoescape true %}
<body>

<style>

.channel-message-displayer{
	width:150px;
	max-height:500px;
	background-color:#888;
	color: white;
	border-radius: 5px 0 0 5px;
	-webkit-border-radius: 5px 0 0 5px;
	-moz-border-radius: 5px 0 0 5px;
	position:absolute;
	bottom:100px;
	right:0;
}

.channel-message{
	border-bottom: 1px #ccc dotted;
	padding:3px;
}
.channel-sender{
	margin-top: 5px;
	color:orange;
}
.channel-sender:after{
	content:':';
}
.channel-message-content{
	border-left: 1px #ccc solid;
	margin-left: 1em;
	padding-left: 3px;
}

</style>

<script type="text/javascript">

	// some global initialization
	var j$=jQuery.noConflict();
    channel = new goog.appengine.Channel('{{ token }}');
    socket = channel.open();
    socket.onopen = onOpened;
    socket.onmessage = onMessage;
    socket.onerror = onError;
    socket.onclose = onClose;
    
    /* https://developers.google.com/appengine/docs/python/channel/javascript */
    function onError(err){
    	j$().toastmessage('showErrorToast','Error code: '+err.code+'<br /> '+err.description);
    }
    
    function onClose(){
    	j$().toastmessage('showNoticeToast','Chat closed! Refresh this page and try again.');
    }
    
    function onMessage(msg){
    	var data=j$.parseJSON(msg.data);
		var html=formatChannelMessage(data['sender_name'],data['message']);	    	
    	refreshChannelMessage(html);
    }
    
    function onOpened(){
    	j$.post(
    		'/channel/route',
    		{'sender':'{{me.key.id()}}',
    		 'receiver':'',
    		 'message':'{{ me.nickname }} connected @ {{ me.key.id() }}'
    		},
    		function(result){
    			//j$().toastmessage('showSuccessToast','Welcome {{ me.nickname }}');
    		}
    	);
    }
</script>

{% block header%}

<div class="header">
	<table class="header-layout">
	<tr><td>
	<h4>Anthem Market Place</h4>
	</td><td>
	<span class="level-1-navigation">
		<ul>		
			<li id="nav-order">
				<a href="/buyorder/browse">
				Shopping
				</a>
			</li>
			<li id="nav-cart">
				<a href="/cart/manage/seller">
				Transaction
				</a>
			</li>			
			<li id="nav-banking">
				<a href="/cart/banking">
				Banking
				</a>
			</li>			
			<li id="nav-user">
				<a href="/user/contact">
				My Profile
				</a>
			</li>
			<li id="nav-report">
				<!-- default to report last 7 days -->
				<a href="/report/buyorder/7/">
				Report
				</a>
			</li>
		</ul>
		</span>
	</td><td style="text-align:right;">
		<span>{{ me.nickname }}</span>
		<a href="{{ url_logout }}" class="bubble-button" style="margin-right:50px;">Logout</a>
	</td></tr>
	</table>
</div>
{% endblock %}

<div class="wrapper">
<table id="site-layout">
<tr>
	<td class="level-2-navigation" style="display:none;">
		{% block level_2_navigation %}
		
		{% endblock %}
	</td>
	<td>
		<div class="main">
		{% block main %}{% endblock %}
		</div>
	</td>
</tr>

</table>

	<!-- message pane -->
		<div class="channel-message-displayer" id="channel-message">
		
		</div>
		
		<div class="channel-message-writer" style="width:100px;">
			<input class="ss-input" type="text" name="receiver-name" placeholder="@ah.banana.slug"/>
			<br />
			<input class="ss-input" type="text" name="channel-message" placeholder=""/>
		</div>
		
		<button id="send-channel-message">Send</button>

<div class="push"></div>
</div>

{% block footer %}
<div class="footer">
<div style="margin-right:auto;margin-left:auto;width:67%;">
<ul>
<li>&copy; 2013 All Rights Reservered by the Anthem Market Place<br />
	Seraifaith Inc.
</li>

<li>
	<a href="mailto:anthem.marketplace@gmail.com">Contact Us</a>
</li>
<li>
	<a href="">Term of Service</a>

</li>
</ul>
</div>
</div>
{% endblock %}

 
</body>
{% endautoescape %}

</html>
